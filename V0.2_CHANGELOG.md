# FaraCore v0.2 Changelog

## Summary

This release adds risk scoring, audit ledger, LangChain integration, Docker support, and UI improvements while maintaining 100% backward compatibility.

## New Features

### 1. Risk Scoring (YAML-driven)
- Added optional `risk` section to policy YAML files
- Risk rules compute `risk_level` (low/medium/high) independently
- Policy rules can override risk with explicit `risk` field
- High-risk actions automatically require approval even if rule allows
- Default risk level is "low" if no risk rules match

**Example:**
```yaml
risk:
  rules:
    - name: dangerous_shell
      when:
        tool: shell
        operation: run
        pattern: "rm -rf"
      risk_level: high
```

### 2. Audit Ledger (Event Timeline)
- New `action_events` table tracks all state transitions
- Events: `created`, `decision_made`, `approved`, `denied`, `started`, `succeeded`, `failed`
- New API endpoint: `GET /v1/actions/{id}/events`
- CLI command: `faracore events <id>`
- UI shows event timeline in action detail drawer

### 3. LangChain Integration
- New module: `faracore.integrations.langchain.governed_tool`
- `GovernedTool` wrapper intercepts tool calls
- Automatically submits to FaraCore, waits for approval, executes
- Example in `examples/langchain/governed_agent.py`

### 4. Docker Support
- `Dockerfile` for production builds
- `docker-compose.yaml` with server + demo agent
- `.dockerignore` for clean builds
- Environment variable support for all config

### 5. CLI Improvements
- `faracore events <id>` - Show event timeline
- `faracore approve <id>` - Alias for `allow`
- All commands support prefix matching (8+ chars)
- Pretty formatting with rich/tabulate (graceful fallback)

### 6. UI Improvements
- Event timeline drawer in action details
- Demo badge for demo-seeded actions
- Full ID tooltip on hover
- Copy-to-clipboard for curl commands
- Improved status highlighting

### 7. Demo Seed Mode
- `FARACORE_DEMO=1` seeds 5 demo actions if DB is empty
- Actions marked with `agent_id="demo"` and `context={"demo": true}`
- UI shows "DEMO" badge

### 8. Environment Configuration
- `FARACORE_HOST` - Server host
- `FARACORE_PORT` - Server port
- `FARACORE_TOKEN` - Auth token (overrides FARA_AUTH_TOKEN)
- `FARACORE_ENABLE_CORS` - CORS control (default: enabled)

## Files Added

- `src/faracore/integrations/__init__.py`
- `src/faracore/integrations/langchain/__init__.py`
- `src/faracore/integrations/langchain/governed_tool.py`
- `examples/langchain/governed_agent.py`
- `examples/langchain/README.md`
- `examples/docker/demo_agent.py`
- `Dockerfile`
- `Dockerfile.demo`
- `.dockerignore`
- `docker-compose.yaml`
- `tests/test_risk_scoring.py`
- `tests/test_events.py`

## Files Modified

- `src/faracore/server/policy_engine.py` - Added risk scoring
- `src/faracore/server/storage.py` - Added action_events table and methods
- `src/faracore/server/storage_postgres.py` - Added action_events support
- `src/faracore/server/main.py` - Event tracking, demo seed, env config
- `src/faracore/server/executor.py` - Event tracking on execution
- `src/faracore/cli.py` - Added events command, improved formatting
- `web/src/components/ActionDetails.tsx` - Event timeline, demo badge
- `web/src/components/ActionTable.tsx` - Demo badge
- `web/src/hooks/useEvents.ts` - New hook for events
- `policies/default.yaml` - Added risk rules example
- `README.md` - Updated with all new features
- `QUICKSTART.md` - Updated with examples
- `tests/test_api.py` - Added events endpoint test

## Backward Compatibility

✅ All existing APIs unchanged
✅ All existing CLI commands work as before
✅ Storage schema extended (backward compatible)
✅ Policy format extended (backward compatible)
✅ Default behavior identical when no new features used

## Migration Notes

- Existing databases automatically get `action_events` table on first run
- Existing policies work without risk rules (defaults to "low")
- No breaking changes to SDKs or API contracts
